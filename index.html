<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>White City Spin</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700;900&family=Oswald:wght@500;700&display=swap" rel="stylesheet">

<style>
:root{
    --primary:#ff2a3b;
    --bg:#0b0b0b;
}

body{
    margin:0;
    background:#050505;
    color:#fff;
    font-family:Montserrat,Arial,sans-serif;
}

.spinner-viewport{
    position:relative;
    overflow:hidden;
    height:220px;
    border:2px solid #262626;
    background:#000;
}

.center-line{
    position:absolute;
    inset:0 auto 0 50%;
    width:4px;
    background:var(--primary);
    box-shadow:0 0 25px var(--primary);
    z-index:10;
}

.reel{
    display:flex;
    height:100%;
    transform:translateX(0);
}

.reel-item{
    width:195px;
    flex-shrink:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#111;
}

.reel-item img{
    max-height:150px;
}

.spin-wrap{
    display:flex;
    justify-content:center;
    margin-top:25px;
}

.spin-btn{
    background:#ff2a3b;
    border:none;
    color:white;
    padding:16px 48px;
    font-weight:900;
    cursor:pointer;
}
</style>
</head>

<body>

<div style="padding:50px;max-width:900px;margin:auto">

    <div class="spinner-viewport">
        <div class="center-line"></div>
        <div id="reel" class="reel"></div>
    </div>

    <div class="spin-wrap">
        <button class="spin-btn" onclick="runSpinner()">SPIN</button>
    </div>

</div>

<script>
/* ================= CONFIG ================= */

const DUP_MIN = 1;   // %
const DUP_MAX = 5;   // %
const ITEM_WIDTH = 195;
const LOOPS = 6;
const SAFETY_CAP = 50;

/* ================= STATE ================= */

let spinning = false;
let lastIndex = null;

/* ================= DATA ================= */

const WEAPONS = [
    { name:"Switch", img:"https://via.placeholder.com/160?text=Switch" },
    { name:"Canik",  img:"https://via.placeholder.com/160?text=Canik" },
    { name:"Walter", img:"https://via.placeholder.com/160?text=Walter" },
    { name:"Glock",  img:"https://via.placeholder.com/160?text=Glock" },
    { name:"Uzi",    img:"https://via.placeholder.com/160?text=Uzi" }
];

/* ================= BUILD REEL ================= */

const reel = document.getElementById("reel");

function buildReel(){
    reel.innerHTML = "";
    for(let i=0;i<WEAPONS.length*12;i++){
        const w = WEAPONS[i % WEAPONS.length];
        const div = document.createElement("div");
        div.className = "reel-item";
        div.innerHTML = `<img src="${w.img}">`;
        reel.appendChild(div);
    }
}
buildReel();

/* ================= RNG ================= */

function allowDuplicate(){
    const chance = Math.random() * (DUP_MAX - DUP_MIN) + DUP_MIN;
    return Math.random() * 100 < chance;
}

function pickFinalIndex(){
    let attempts = 0;
    let index;

    do{
        index = Math.floor(Math.random() * WEAPONS.length);

        if(lastIndex === null) break;
        if(index !== lastIndex) break;
        if(allowDuplicate()) break;

        attempts++;
    }while(attempts < SAFETY_CAP);

    return index;
}

/* ================= SPINNER ================= */

function runSpinner(){
    if(spinning) return;
    spinning = true;

    const finalIndex = pickFinalIndex();
    const targetIndex = LOOPS * WEAPONS.length + finalIndex;

    const targetX =
        targetIndex * ITEM_WIDTH -
        (reel.parentElement.offsetWidth / 2 - ITEM_WIDTH / 2);

    reel.style.transition = "none";
    reel.style.transform = "translateX(0)";

    requestAnimationFrame(()=>{
        reel.style.transition =
            "transform 4.2s cubic-bezier(.08,.6,.1,1)";
        reel.style.transform = `translateX(-${targetX}px)`;
    });

    setTimeout(()=>{
        lastIndex = finalIndex;
        spinning = false;
        console.log("Landed on:", WEAPONS[finalIndex].name);
    },4200);
}
</script>

</body>
</html>
