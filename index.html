<script>
/* ---------------- SPINNER LOGIC FIX ---------------- */

const reel = document.getElementById("reel");
let spinning = false;

function getWeaponPool(tier) {
    if (tier === "all") {
        // Test Drop → ONLY Tier 1
        return [...WEAPONS.t1];
    }

    if (tier === "t1") {
        return [...WEAPONS.t1];
    }

    if (tier === "t15") {
        // Tier 1.5 → Tier 1 + Tier 1.5
        return [...WEAPONS.t1, ...WEAPONS.t15];
    }

    if (tier === "t2") {
        // Tier 2 → Tier 2 + some Tier 1
        return [...WEAPONS.t2, ...WEAPONS.t1];
    }

    return [];
}

function getSpinConfig(tier) {
    if (tier === "all") return { spins: 2, results: 1 };
    if (tier === "t1") return { spins: 4, results: 4 };
    if (tier === "t15") return { spins: 4, results: 4 };
    if (tier === "t2") return { spins: 6, results: 6 };
}

function createReelItems(pool, count = 30) {
    reel.innerHTML = "";
    const items = [];

    for (let i = 0; i < count; i++) {
        const weapon = pool[Math.floor(Math.random() * pool.length)];
        items.push(weapon);

        const div = document.createElement("div");
        div.className = "reel-item";
        div.innerHTML = `<img src="${weapon.img}">`;
        reel.appendChild(div);
    }

    return items;
}

function runSpinner() {
    if (spinning) return;
    spinning = true;

    const tier = document.getElementById("spin-tier").value;
    const pool = getWeaponPool(tier);
    const config = getSpinConfig(tier);

    const reelItems = createReelItems(pool, 40);

    const itemWidth = 195; // card width + gap
    const totalDistance =
        itemWidth * (reelItems.length - config.results) +
        itemWidth * config.spins;

    reel.style.transition = "none";
    reel.style.transform = "translateX(0px)";

    requestAnimationFrame(() => {
        reel.style.transition =
            "transform 3.8s cubic-bezier(0.12, 0.75, 0.25, 1)";
        reel.style.transform = `translateX(-${totalDistance}px)`;
    });

    setTimeout(() => {
        spinning = false;
    }, 4000);
}
</script>
